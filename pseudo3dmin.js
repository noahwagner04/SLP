let Pseudo3D=function(){class t{constructor(t){if("object"!=typeof t)throw Error("Camera constructor must recieve a config object");let i=["position","direction",];for(let n=0;n<i.length;n++)if(void 0!==t[i[n]]&&("object"!=typeof t[i[n]]||"number"!=typeof t[i[n]].x||"number"!=typeof t[i[n]].y))throw Error("Camera "+i[n]+" must be an object with x and y attributes that are numbers");if(void 0!==t.focalLength&&"number"!=typeof t.focalLength)throw Error("Camera focalLength must be a number");if(void 0!==t.renderDistance&&"number"!=typeof t.renderDistance)throw Error("Camera renderDistance must be a number");if(void 0!==t.pitch&&!Number.isInteger(t.pitch))throw Error("Camera pitch must be an integer");if(void 0!==t.lighting){if("object"!=typeof t.lighting)throw Error("Camera lighting must be an object");if(void 0!==t.lighting.brightness&&"number"!=typeof t.lighting.brightness)throw Error("Camera lighting brightness must be a number");if(t.lighting.brightness=t.lighting.brightness||0,void 0!==t.lighting.maxBrightness&&"number"!=typeof t.lighting.maxBrightness)throw Error("Camera lighting maxBrightness must be a number");if(t.lighting.maxBrightness=t.lighting.maxBrightness||1/0,void 0!==t.lighting.color&&!(t.lighting.color instanceof e))throw Error("Camera lighting color must be of type Color");t.lighting.color=t.lighting.color||new e(255,255,255,255)}let r=t.position||{x:0,y:0},s=t.direction||{x:1,y:0};this.orientation=new o(r.x,r.y,s.x,s.y),this.orientation.position.z=.5,this.focalLength=t.focalLength||1,this.renderDistance=t.renderDistance||1/0,this.plane=new u(-this.orientation.direction.y,this.orientation.direction.x),this.pitch=t.pitch||0,this.lighting=t.lighting||{brightness:0,maxBrightness:1/0,color:new e(255,255,255,255)}}rotate(t){if("number"!=typeof t)throw Error("Camera.rotate must recieve an angle that is a number");return this.orientation.direction.rotate(t),this.plane.x=-this.orientation.direction.y,this.plane.y=this.orientation.direction.x,this}setRotation(t){if("number"!=typeof t)throw Error("Camera.setRotation must recieve an angle that is a number");let e=this.orientation.direction.getMag();return this.orientation.direction.x=Math.cos(t)*e,this.orientation.direction.y=Math.sin(t)*e,this.plane.x=-this.orientation.direction.y,this.plane.y=this.orientation.direction.x,this}move(t,e){if("number"!=typeof t||"number"!=typeof e)throw Error("Camera.move must recieve two numbers");return this.orientation.position.x+=t,this.orientation.position.y+=e,this}setPosition(t,e){if("number"!=typeof t||"number"!=typeof e)throw Error("Camera.setPosition must recieve two numbers");return this.orientation.position.x=t,this.orientation.position.y=e,this}}class e{constructor(t,e,i,n){for(var o=0;o<4;o++)if(!Number.isInteger(arguments[o])||!(arguments[o]>=0&&arguments[o]<=255))throw Error("Color must recieve four integers, each in the range [0, 255]");this.red=t,this.green=e,this.blue=i,this.alpha=n}}class i{constructor(t){if("object"!=typeof t)throw Error("Entity constructor must recieve a config object");if(!(t.appearance instanceof p)&&!(t.appearance instanceof e))throw Error("Entity constructor must receive an appearance argument of type Texture or Color");let i=["position","direction","size"];for(let n=0;n<i.length;n++)if(void 0!==t[i[n]]&&("object"!=typeof t[i[n]]||"number"!=typeof t[i[n]].x||"number"!=typeof t[i[n]].y))throw Error("Entity "+i[n]+" must be an object with x and y attributes that are numbers");if(void 0!==t.position&&void 0!==t.position.z&&"number"!=typeof t.position.z)throw Error("Entity z position must be a number");if(void 0!==t.tint&&!(t.tint instanceof e))throw Error("Entity tint must be of type Color");this.appearance=t.appearance;let r=t.position||{x:0,y:0,z:0},s=t.direction||{x:1,y:0};this.orientation=new o(r.x,r.y,s.x,s.y),this.orientation.position.z=r.z||0,this.size=t.size||{x:1,y:1},this.tint=t.tint,this.isVisible=void 0==t.isVisible||!!t.isVisible,this.affectedByLighting=void 0==t.affectedByLighting||!!t.affectedByLighting,this.hasPartialAlpha=!!t.hasPartialAlpha}}let n={};n.remap=function(t,e,i,n,o){if("number"!=typeof t||"number"!=typeof e||"number"!=typeof i||"number"!=typeof n||"number"!=typeof o)throw Error("remap must recieve five numbers");return(t-e)/(i-e)*(o-n)+n},n.constrain=function(t,e,i){if("number"!=typeof t||"number"!=typeof e||"number"!=typeof i)throw Error("constrain must recieve three numbers");return Math.min(Math.max(x,e),i)};class o{constructor(t,e,i,n){if("number"!=typeof t||"number"!=typeof e||"number"!=typeof i||"number"!=typeof n)throw Error("Orientation constructor must recieve four numbers");this.position=new u(t,e),this.direction=new u(i,n).normalize()}}class r{static faces=["north","east","south","west"];constructor(t,e,i,n,o,r){if(!(t instanceof d))throw Error("Ray constructor must receive a scene of type Scene");if("number"!=typeof e||"number"!=typeof i||"number"!=typeof n||"number"!=typeof o)throw Error("Ray constructor must receive four numbers: startX, startY, dirX, dirY");if(void 0!==r&&"number"!=typeof r)throw Error("Ray constructor must receive a length that is a number");this.scene=t,r=r||Math.sqrt(n*n+o*o),this.init(e,i,n,o,r)}init(t,e,i,n,o){this.mapX=Math.floor(t),this.mapY=Math.floor(e),this.sideDistX,this.sideDistY,this.stepX,this.stepY,this.deltaDistX=Math.abs(o/i),this.deltaDistY=Math.abs(o/n),this.hit=0,this.side=0,this.face="",i<0?(this.stepX=-1,this.sideDistX=(t-this.mapX)*this.deltaDistX):(this.stepX=1,this.sideDistX=(this.mapX+1-t)*this.deltaDistX),n<0?(this.stepY=-1,this.sideDistY=(e-this.mapY)*this.deltaDistY):(this.stepY=1,this.sideDistY=(this.mapY+1-e)*this.deltaDistY),this.side=this.sideDistX>this.sideDistY?1:0,0===this.side?this.stepX<0?this.face=3:this.face=1:this.stepY<0?this.face=0:this.face=2,this.distance=0}cast(){for(this.hit=0;0===this.hit&&(this.sideDistX>this.sideDistY?(this.mapY+=this.stepY,this.sideDistY+=this.deltaDistY,this.side=1):(this.mapX+=this.stepX,this.sideDistX+=this.deltaDistX,this.side=0),!(this.mapX<0)&&!(this.mapY<0)&&!(this.mapX>=this.scene.worldMap.width)&&!(this.mapY>=this.scene.worldMap.height));)this.hit=this.scene.worldMap.data[this.mapX+this.mapY*this.scene.worldMap.width];0===this.side?(this.distance=this.sideDistX-this.deltaDistX,this.stepX<0?this.face=3:this.face=1):(this.distance=this.sideDistY-this.deltaDistY,this.stepY<0?this.face=0:this.face=2)}}var s={};function h(t,e,i,n,o){let r=t.renderHeight/2+Math.floor(e.pitch),s=i/o*t.renderHeight,h=r-(n-e.orientation.position.z)/o*t.renderHeight;return{start:Math.floor(h-s),end:Math.floor(h)}}function a(t,e,i,n){if(!t.lighting.enabled)return{r:1,g:1,b:1};let o=e.lighting.brightness/(i*e.focalLength);return o>e.lighting.maxBrightness&&(o=e.lighting.maxBrightness),o<t.lighting.ambientLight&&(o=t.lighting.ambientLight),1===n&&(o-=t.lighting.sideShade),{r:o*e.lighting.color.red/255,g:o*e.lighting.color.green/255,b:o*e.lighting.color.blue/255}}function l(t,e,i,n,o,r,s){if(255===i.alpha){n<0&&(n=0),o>t.renderHeight&&(o=t.renderHeight);for(let h=n;h<o;h++){let a=e+h*t.renderWidth;-1!==r&&t.depthBuffer[a]<r||(t.pixels[4*a]=Math.floor(i.red*s.r),t.pixels[4*a+1]=Math.floor(i.green*s.g),t.pixels[4*a+2]=Math.floor(i.blue*s.b),t.pixels[4*a+3]=255,-1===r||(t.depthBuffer[a]=r))}}}function c(t,e,i,n,o,r,s,h){let a=i.height/(r-o),l=o<0?-o*a:0;o<0&&(o=0),r>t.renderHeight&&(r=t.renderHeight);for(let c=o;c<r;c++){let d=e+c*t.renderWidth;if(-1!==s&&t.depthBuffer[d]<=s){l+=a;continue}let f=(n+Math.floor(l)*i.width)*4;if(255!==i.pixels[f+3]){l+=a;continue}t.pixels[4*d]=Math.floor(i.pixels[f]*h.r),t.pixels[4*d+1]=Math.floor(i.pixels[f+1]*h.g),t.pixels[4*d+2]=Math.floor(i.pixels[f+2]*h.b),t.pixels[4*d+3]=255,l+=a,-1!==s&&(t.depthBuffer[d]=s)}}s.renderWalls=function(t,e,i){let n=new r(e,i.orientation.position.x,i.orientation.position.y,0,1,1);for(let o=0;o<t.renderWidth;o++){let s=o/t.renderWidth-.5,d=i.orientation.direction.x*i.focalLength+i.plane.x*t.aspectRatio*s,f=i.orientation.direction.y*i.focalLength+i.plane.y*t.aspectRatio*s;for(n.init(i.orientation.position.x,i.orientation.position.y,d,f,1);;){n.cast();let g=e.worldMap.cellInfo[n.hit];if(0===n.hit||n.distance*i.focalLength>i.renderDistance)break;if(void 0===g)continue;let u=h(t,i,g.height,g.elevation,n.distance),m=a(e,i,n.distance,n.side),b=g.appearance[r.faces[n.face]];if(b.hasLoaded){let $;$=0===n.side?i.orientation.position.y+n.distance*f:i.orientation.position.x+n.distance*d;let y=Math.floor(($-=Math.floor($))*b.width);0===n.side&&d>0&&(y=b.width-y-1),1===n.side&&f<0&&(y=b.width-y-1),c(t,o,b,y,u.start,u.end,n.distance,m)}else{let w;l(t,o,w=b instanceof p?b.temporaryColor:b,u.start,u.end,n.distance,m)}}}},s.renderFloorCeiling=function(t,i,n){let o=t.renderHeight,r=t.renderWidth,s=Math.floor(o/2+n.pitch)-1,h=i.ceiling.enabled?0:s,l=i.floor.enabled?o:s;h>o&&(h=o),h<0&&(h=0),l>o&&(l=o),l<0&&(l=0);let c=i.floor.appearance,d=i.ceiling.appearance;!1===i.floor.appearance.hasLoaded&&(c=i.floor.appearance.temporaryColor),!1===i.ceiling.appearance.hasLoaded&&(d=i.ceiling.appearance.temporaryColor);let f=n.orientation.direction.x*n.focalLength-n.plane.x*t.aspectRatio*.5,g=n.orientation.direction.y*n.focalLength-n.plane.y*t.aspectRatio*.5,p=n.orientation.direction.x*n.focalLength+n.plane.x*t.aspectRatio*.5,u=n.orientation.direction.y*n.focalLength+n.plane.y*t.aspectRatio*.5;for(let m=h;m<l;m++){let b=m>=s,$=b?c:d,y=$ instanceof e,w=b?i.floor.cellWidth:i.ceiling.cellWidth,v=b?i.floor.cellHeight:i.ceiling.cellHeight,_=m-s,C=Math.abs((b?n.orientation.position.z*o:o*(i.ceiling.height-n.orientation.position.z))/_);if(C*n.focalLength>n.renderDistance)continue;let S=(p-f)*((C=C===1/0?1e3:C)/t.renderWidth),D=(u-g)*(C/t.renderWidth),j=n.orientation.position.x+f*C,L=n.orientation.position.y+g*C,z=a(i,n,C);for(let V=0;V<t.renderWidth;V++){let I=V+m*r;if(t.depthBuffer[I]<=C){j+=S,L+=D;continue}let X,Y,W,M;if(y)X=Math.floor($.red*z.r),Y=Math.floor($.green*z.g),W=Math.floor($.blue*z.b),M=255;else{let B,E=(Math.floor($.width*Math.abs(j%w/w))+Math.floor($.height*Math.abs(L%v/v))*$.width)*4;X=Math.floor($.pixels[E]*z.r),Y=Math.floor($.pixels[E+1]*z.g),W=Math.floor($.pixels[E+2]*z.b),M=255}t.pixels[4*I]=X,t.pixels[4*I+1]=Y,t.pixels[4*I+2]=W,t.pixels[4*I+3]=M,j+=S,L+=D,t.depthBuffer[I]=C}}},s.renderEntities=function(t,i,n){for(let o=0;o<i.gameObject.entities.length;o++){let r=i.gameObject.entities[o];if(!r.isVisible)continue;let s=r.orientation.position.x-n.orientation.position.x,d=r.orientation.position.y-n.orientation.position.y,f=n.orientation.direction.x*n.focalLength,g=n.orientation.direction.y*n.focalLength,p=n.plane.x*t.aspectRatio/2,u=n.plane.y*t.aspectRatio/2,m=1/(n.plane.x*t.aspectRatio/2*g-f*n.plane.y*t.aspectRatio/2),b=m*(g*s-f*d),$=m*(-u*s+p*d);if($<0||$*n.focalLength>n.renderDistance)continue;let y=(b/$+1)/2*t.renderWidth,w=r.size.x/$*t.renderWidth/t.aspectRatio,v=Math.floor(y-w/2),_=Math.floor(y+w/2),C=v;C<0?C=0:C>t.renderWidth&&(C=t.renderWidth);let S=_;S<0?S=0:S>t.renderWidth&&(S=t.renderWidth);let D=h(t,n,r.size.y,r.orientation.position.z,$),j=!1;r.appearance instanceof e?j=!0:!1===r.appearance.hasLoaded&&(j=!0);let L=r.affectedByLighting?a(i,n,$):{r:1,g:1,b:1};for(let z=C;z<S;z++){if(j){l(t,z,r.appearance,D.start,D.end,$,L);continue}let V=Math.floor((z-v)/(_-v)*r.appearance.width);c(t,z,r.appearance,V,D.start,D.end,$,L)}}},s.renderSkybox=function(t,i,n){let o=i.skybox.appearance;!1===o.hasLoaded&&(o=o.temporaryColor);let s=Math.floor(t.renderHeight/2+n.pitch);if(o instanceof e)t.drawingContext.save(),t.drawingContext.fillStyle=`rgb(
			${o.red*i.lighting.ambientLight}, 
			${o.green*i.lighting.ambientLight}, 
			${o.blue*i.lighting.ambientLight}
		)`,t.drawingContext.fillRect(0,0,t.renderWidth,s),t.drawingContext.restore(),t.setPixels();else if(o instanceof p){let h=new r(i,.5,.5,0,1,1),a=i.skybox.ignoreLighting?1:i.lighting.ambientLight;for(let l=0;l<t.renderWidth;l++){let d,f,g=l/t.renderWidth-.5,u=n.orientation.direction.x*n.focalLength+n.plane.x*t.aspectRatio*g,m=n.orientation.direction.y*n.focalLength+n.plane.y*t.aspectRatio*g;h.init(.5,.5,u,m,1),h.sideDistX<h.sideDistY?(f=.5+h.sideDistX*m,d=2*h.sideDistX):(f=.5+h.sideDistY*u,d=2*h.sideDistY),f-=Math.floor(f),0===h.side&&u<0&&(f=1-f),1===h.side&&m>0&&(f=1-f);let b=Math.floor((f+=h.face)*o.width/4),$=Math.floor(o.height/d);c(t,l,o,b,s-$,s,-1,{r:a,g:a,b:a})}}},s.render=function(e,i,n){if(!(e instanceof g))throw Error("Failed to render scene: first argument passed to Renderer.render was not an instance of Pseudo3d.Screen");if(!(i instanceof d))throw Error("Failed to render scene: second argument passed to Renderer.render was not an instance of Pseudo3d.Scene");if(!(n instanceof t))throw Error("Failed to render scene: third argument passed to Renderer.render was not an instance of Pseudo3d.Camera");i.skybox.enabled&&s.renderSkybox(e,i,n),0!==i.worldMap.data.length&&0!==Object.keys(i.worldMap.cellInfo).length&&s.renderWalls(e,i,n),0!==i.gameObject.entities.length&&s.renderEntities(e,i,n),(!0===i.floor.enabled||!0===i.ceiling.enabled)&&s.renderFloorCeiling(e,i,n)};class d{constructor(t){if("object"!=typeof t)throw Error("Scene constructor must recieve a config object");let i=["floor","ceiling","worldMap","gameObject","skybox","lighting"];for(let n=0;n<i.length;n++){let o=t[i[n]];if(void 0!==o&&"object"!=typeof o)throw Error("Scene config."+i[n]+" must be an object");t[i[n]]=o||{}}(function t(e){if(void 0!==e.width&&(!Number.isInteger(e.width)||e.width<0))throw Error("Scene worldMap.width must be a positive integer");if(void 0!==e.height&&(!Number.isInteger(e.height)||e.height<0))throw Error("Scene worldMap.height must be a positive integer");if(e.width=e.width||0,e.height=e.height||0,void 0!==e.data&&!Array.isArray(e.data))throw Error("Scene worldMap.data must be an array");if(void 0===e.data){e.data=[];for(let i=0;i<e.height*e.width;i++)e.data[i]=0}if(e.data.length!==e.height*e.width)throw Error("Scene worldMap.data length must be worldMap.width * worldMap.height");if(void 0!==e.cellInfo&&"object"!=typeof e.cellInfo)throw Error("Scene worldMap.cellInfo must be an object");for(let n in e.cellInfo=e.cellInfo||{},e.cellInfo)f(n,e.cellInfo[n])})(t.worldMap),function t(i,n){for(let o=0;o<2;o++){let r=0===o?i:n,s=0===o?"floor":"ceiling";if("{}"===JSON.stringify(r)?r.enabled=!1:r.enabled=!0,void 0!==r.appearance&&!(r.appearance instanceof e)&&!(r.appearance instanceof p))throw Error("Scene "+s+".appearance must be of type Color or Texture");if(r.appearance=r.appearance||new e(0,0,0,0),void 0!==r.cellWidth&&"number"!=typeof r.cellWidth)throw Error("Scene "+s+".cellWidth must be a number");if(void 0!==r.cellHeight&&"number"!=typeof r.cellHeight)throw Error("Scene "+s+".cellHeight must be a number");r.cellWidth=r.cellWidth||1,r.cellHeight=r.cellHeight||1}if(void 0!==n.height&&"number"!=typeof n.height)throw Error("Scene ceiling.height must be a number");n.height=n.height||1}(t.floor,t.ceiling),function t(e){if(void 0!==e.entities&&!Array.isArray(e.entities))throw Error("Scene gameObject.entities must be an array of Entities");if(e.entities=e.entities||[],void 0!==e.resolutionX&&(!Number.isInteger(e.resolutionX)||e.resolutionX<0))throw Error("Scene gameObject.resolutionX must be a positive integer");if(void 0!==e.resolutionY&&(!Number.isInteger(e.resolutionY)||e.resolutionY<0))throw Error("Scene gameObject.resolutionY must be a positive integer");e.resolutionX=e.resolutionX||64,e.resolutionY=e.resolutionY||64}(t.gameObject),function t(i){if(void 0!==i.appearance&&!(i.appearance instanceof e)&&!(i.appearance instanceof p))throw Error("Scene skybox.appearance must be of type Color or Texture");i.ignoreLighting=!!i.ignoreLighting,void 0===i.appearance?(i.appearance=new e(0,0,0,0),i.enabled=!1):i.enabled=!0}(t.skybox),function t(e){if(void 0!==e.sideShade&&"number"!=typeof e.sideShade)throw Error("Scene lighting.sideShade must be a number");if(e.sideShade=void 0===e.sideShade?0:e.sideShade,void 0!==e.ambientLight&&"number"!=typeof e.ambientLight)throw Error("Scene lighting.ambientLight must be a number");e.ambientLight=void 0===e.ambientLight?1:e.ambientLight,e.enabled=!(0===e.sideShade&&1===e.ambientLight)}(t.lighting),this.worldMap=t.worldMap,this.floor=t.floor,this.ceiling=t.ceiling,this.gameObject=t.gameObject,this.skybox=t.skybox,this.lighting=t.lighting}add(t,e,...i){return"entity"===t&&this.gameObject.entities.push(e),"cellInfo"===t&&(this.worldMap.cellInfo[i[0]]=e,f(i[0],this.worldMap.cellInfo[i[0]])),this}remove(t){if(t instanceof i){let e=this.gameObject.entities.indexOf(t);this.gameObject.entities.splice(e,1)}return this}}function f(t,i){if("object"!=typeof i)throw Error('Scene cellInfo["'+t+'"] must be an object');let n=i.height;if(void 0!==n&&"number"!=typeof n)throw Error('Scene cellInfo["'+t+'"].height must be a number');i.height=void 0===n?1:n;let o=i.elevation;if(void 0!==o&&"number"!=typeof o)throw Error('Scene cellInfo["'+t+'"].elevation must be a number');i.elevation=void 0===o?0:o;let r=i.appearance;if(void 0!==r&&"object"!=typeof r&&!(r instanceof e)&&!(r instanceof p))throw Error('Scene cellInfo["'+t+'"].appearance must be of type Color or Texture, or object');void 0===r&&(r=new e(0,0,0,0));let s;for(let h in s=r instanceof e||r instanceof p?{north:r,south:r,east:r,west:r}:{north:r.north,south:r.south,east:r.east,west:r.west})s[h]instanceof e||s[h]instanceof p||(s[h]=new e(0,0,0,0));i.appearance=s}class g{constructor(t,e,i){if(!Number.isInteger(t)||t<=0)throw Error("Screen width must be a positive non-zero integer");if(!Number.isInteger(e)||e<=0)throw Error("Screen height must be a positive non-zero integer");if("number"!=typeof i||!(i>0&&i<=1))throw Error("Screen quality must be a number in the range (0, 1]");if(this.width=t,this.height=e,this.quality=i,this.renderWidth=Math.round(t*i)||1,this.renderHeight=Math.round(e*i)||1,this.htmlCanvasElement=document.createElement("canvas"),!window.CanvasRenderingContext2D)throw Error("Screen failed to initialize because the Canvas element is not supported on this browser");this.drawingContext=this.htmlCanvasElement.getContext("2d",{willReadFrequently:!0}),this.htmlCanvasElement.width=this.renderWidth,this.htmlCanvasElement.height=this.renderHeight,this.htmlCanvasElement.style.width=this.width+"px",this.htmlCanvasElement.style.height=this.height+"px",this.htmlCanvasElement.style["image-rendering"]="pixelated",this.pixels=this.drawingContext.getImageData(0,0,this.renderWidth,this.renderHeight).data,this.depthBuffer=[];for(let n=0;n<this.renderHeight*this.renderWidth;n++)this.depthBuffer[n]=1/0;this.aspectRatio=this.renderWidth/this.renderHeight}clear(){let t=this.drawingContext.createImageData(this.renderWidth,this.renderHeight);this.drawingContext.putImageData(t,0,0),this.pixels=t.data;for(let e=0;e<this.renderHeight*this.renderWidth;e++)this.depthBuffer[e]=1/0}setPixels(){this.pixels=this.drawingContext.getImageData(0,0,this.renderWidth,this.renderHeight).data}update(){let t=new ImageData(this.pixels,this.renderWidth);this.drawingContext.putImageData(t,0,0)}setParent(t){if(!(t instanceof Node))throw Error("Failed to execute Screen.setParent: parameter 1 is not of type node");t.appendChild(this.htmlCanvasElement)}}class p{constructor(t){if("object"!=typeof t)throw Error("Texture constructor must recieve a config object");if("string"!=typeof t.path)throw Error("Texture must recieve source path of type String for image to load");if(void 0!==t.temporaryColor){if(t.temporaryColor instanceof e)this.temporaryColor=t.temporaryColor;else throw Error("Texture temporaryColor must be of type Color")}if(void 0!==t.width){if(Number.isInteger(t.width)&&t.width>0)this.width=t.width;else throw Error("Texture width must be an integer greater than 0")}if(void 0!==t.height){if(Number.isInteger(t.height)&&t.height>0)this.height=t.height;else throw Error("Texture height must be an integer greater than 0")}if(this.width&&!this.height||!this.width&&this.height)throw Error("Texture constructor must receive width and height together");this.path=t.path,this.pixels=void 0,this.hasLoaded=!1,this.temporaryColor=t.temporaryColor||new e(0,0,0,0),this.htmlImageElement=new Image(this.width,this.height),this.htmlImageElement.addEventListener("load",(function(){this.hasLoaded=!0,this.width||this.height||(this.width=this.htmlImageElement.width,this.height=this.htmlImageElement.height);let t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.width,t.height=this.height,e.drawImage(this.htmlImageElement,0,0,this.width,this.height),this.pixels=e.getImageData(0,0,this.width,this.height).data}).bind(this)),this.htmlImageElement.addEventListener("error",(function(t){throw Error("Failed to load image with path "+this.path)}).bind(this)),this.htmlImageElement.src=this.path}}class u{constructor(t,e,i){if("number"!=typeof t||"number"!=typeof e)throw Error("Vector constructor must recieve at least two numbers");if("number"!=typeof i&&void 0!==i)throw Error("Vector z component must be a number");this.x=t,this.y=e,i?(this.z=i,this.is2d=!1):(this.z=0,this.is2d=!0)}add(t){if(!u.isVector(t))throw Error("Vector.add must recieve an object of type Vector");return this.x+=t.x,this.y+=t.y,this.is2d||(this.z+=t.z),this}addConst(t){if("number"!=typeof t)throw Error("Vector.addConst must recieve a number");return this.x+=t,this.y+=t,this.is2d||(this.z+=t),this}subtract(t){if(!u.isVector(t))throw Error("Vector.subtract must recieve an object of type Vector");return this.x-=t.x,this.y-=t.y,this.is2d||(this.z-=t.z),this}subtractConst(t){if("number"!=typeof t)throw Error("Vector.subtractConst must recieve a number");return this.x-=t,this.y-=t,this.is2d||(this.z-=t),this}scale(t){if("number"!=typeof t)throw Error("Vector.scale must recieve a number");return this.x*=t,this.y*=t,this.is2d||(this.z*=t),this}getMagSqr(){return this.is2d?this.x*this.x+this.y*this.y:this.x*this.x+this.y*this.y+this.z*this.z}getMag(){return Math.sqrt(this.getMagSqr())}normalize(){let t=this.getMag();return 0===t||(this.x/=t,this.y/=t,this.is2d||(this.z/=t)),this}setMag(t){if("number"!=typeof t)throw Error("Vector.setMag must recieve a number");return this.normalize().scale(t),this}getSqrDistBtw(t){if(!u.isVector(t))throw Error("Vector.getSqrDistBtw must recieve an object of type Vector");return t.clone().subtract(this).getMagSqr()}getDistBtw(t){if(!u.isVector(t))throw Error("Vector.getDistBtw must recieve an object of type Vector");return Math.sqrt(this.getSqrDistBtw(t))}dot(t){if(!u.isVector(t))throw Error("Vector.dot must recieve an object of type Vector");return this.is2d?this.x*t.x+this.y*t.y:this.x*t.x+this.y*t.y+this.z*t.z}rotate(t,e,i){if("number"!=typeof t)throw Error("Vector.rotate must recieve at least one number");if(!this.is2d&&("number"!=typeof e||"number"!=typeof i))throw Error("Vector.rotate must recieve three numbers if the vector is 3d");let n=Math.cos(t),o=Math.sin(t),r=this.is2d?0:Math.cos(e),s=this.is2d?0:Math.sin(e),h=this.is2d?0:Math.cos(i),a=this.is2d?0:Math.sin(i),l=this.x,c=this.y,d=this.z;return this.is2d?(this.x=l*n-c*o,this.y=l*o+c*n):(this.x=l*(h*r)+c*(h*s*o-a*n)+d*(h*s*n+a*o),this.y=l*(a*r)+c*(a*s*o+h*n)+d*(a*s*n-h*o),this.z=-(l*s)+c*(r*o)+d*(r*n)),this}getAngleBtw(t){if(!u.isVector(t))throw Error("Vector.getAngleBtw must recieve an object of type Vector");return Math.acos(this.dot(t)/(this.getMag()*t.getMag()))}getScalarProj(t){if(!u.isVector(t))throw Error("Vector.getScalarProj must recieve an object of type Vector");return this.dot(t)/t.getMag()}project(t){if(!u.isVector(t))throw Error("Vector.project must recieve an object of type Vector");return this.setTo(t.clone().setMag(this.getScalarProj(t)))}setTo(t){if(!u.isVector(t))throw Error("Vector.setTo must recieve an object of type Vector");return this.x=t.x,this.y=t.y,this.is2d&&(this.z=t.z),this}clone(){return this.is2d?new u(this.x,this.y):new u(this.x,this.y,this.z)}static isVector(t){return t instanceof u}}return{Camera:t,Entity:i,Ray:r,Renderer:s,Scene:d,Screen:g,Math:n,Orientation:o,Vector:u,Color:e,Texture:p}}();

export { Pseudo3D };